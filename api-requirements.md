# API Требования для Страницы Рекомендаций

## Описание

Этот документ содержит подробные требования к API бэкенда для обслуживания страницы рекомендаций в приложении. Страница рекомендаций состоит из трех основных компонентов:
1. `EnhancedRecommendations` - список персональных рекомендаций с возможностью фильтрации и изменения статуса
2. `RecommendationsStats` - статистика по рекомендациям
3. `RecommendationInfo` - информация о рекомендациях (статический компонент, не требует API)

## Типы данных

### Основные типы

```typescript
// Категория рекомендации
type RecommendationCategory = 'sleep' | 'stress' | 'work' | 'activity';

// Приоритет рекомендации
type RecommendationPriority = 'high' | 'medium' | 'low';

// Статус рекомендации
type RecommendationStatus = 'new' | 'in_progress' | 'completed' | 'skipped';

// Рекомендация
interface Recommendation {
  id: string;
  category: RecommendationCategory;
  title: string;
  description: string;
  priority: RecommendationPriority;
  status: RecommendationStatus;
  createdDate: string; // формат 'YYYY-MM-DD'
  completedDate?: string; // формат 'YYYY-MM-DD'
}

// Статистика рекомендаций
interface RecommendationsStats {
  total: number;
  completed: number;
  inProgress: number;
  new: number;
  skipped: number;
  completionRate: number; // процент выполнения (0-100)
}
```

## API Endpoints

### 1. Получение списка рекомендаций

#### Запрос
```
GET /api/recommendations
```

#### Параметры запроса
- `category` (опционально): фильтр по категории (`sleep`, `stress`, `work`, `activity`)
- `status` (опционально): фильтр по статусу (`new`, `in_progress`, `completed`, `skipped`)
- `priority` (опционально): фильтр по приоритету (`high`, `medium`, `low`)

#### Успешный ответ (200 OK)
```json
{
  "recommendations": [
    {
      "id": "1",
      "category": "work",
      "title": "Делайте регулярные перерывы",
      "description": "Старайтесь делать 5-минутный перерыв каждый час работы. Это поможет снизить утомляемость и повысить продуктивность.",
      "priority": "high",
      "status": "in_progress",
      "createdDate": "2023-05-01"
    },
    // ...другие рекомендации
  ]
}
```

### 2. Обновление статуса рекомендации

#### Запрос
```
PATCH /api/recommendations/{id}/status
```

#### Тело запроса
```json
{
  "status": "completed" // новый статус рекомендации
}
```

#### Успешный ответ (200 OK)
```json
{
  "id": "1",
  "category": "work",
  "title": "Делайте регулярные перерывы",
  "description": "Старайтесь делать 5-минутный перерыв каждый час работы. Это поможет снизить утомляемость и повысить продуктивность.",
  "priority": "high",
  "status": "completed",
  "createdDate": "2023-05-01",
  "completedDate": "2023-05-05"
}
```

### 3. Получение статистики рекомендаций

#### Запрос
```
GET /api/recommendations/stats
```

#### Успешный ответ (200 OK)
```json
{
  "total": 14,
  "completed": 5,
  "inProgress": 3,
  "new": 4,
  "skipped": 2,
  "completionRate": 36
}
```

## Требования к обработке ошибок

### Ошибка аутентификации (401 Unauthorized)
```json
{
  "error": "Требуется аутентификация"
}
```

### Ошибка доступа (403 Forbidden)
```json
{
  "error": "Доступ запрещен"
}
```

### Ресурс не найден (404 Not Found)
```json
{
  "error": "Рекомендация не найдена"
}
```

### Ошибка валидации (400 Bad Request)
```json
{
  "error": "Некорректный запрос",
  "details": {
    "status": "Некорректный статус. Допустимые значения: new, in_progress, completed, skipped"
  }
}
```

## Требования безопасности

1. Все API-запросы должны требовать аутентификацию (JWT токен в заголовке Authorization)
2. Доступ к рекомендациям должен быть ограничен текущим пользователем
3. Все данные должны передаваться по HTTPS
4. Необходима защита от Cross-Site Request Forgery (CSRF)

## Требования к производительности

1. Время ответа API не должно превышать 300 мс
2. API должно поддерживать пагинацию для больших списков рекомендаций
3. Необходимо реализовать кэширование для часто запрашиваемых данных (например, статистики)

## Дополнительные требования

1. API должно вести логирование всех запросов и ошибок
2. Необходима документация API с использованием OpenAPI/Swagger
3. API должно поддерживать версионирование (например, `/api/v1/recommendations`)
4. Для фронтенда требуется предусмотреть механизм оптимистичного обновления UI при изменении статуса рекомендации

## Несоответствия между существующим кодом и требованиями к API

При реализации API необходимо учесть несоответствия между типами в существующем фронтенд-коде и предлагаемой структурой API:

1. В файле `app/types/recommendation.ts` имеется отличия по сравнению с используемыми типами в компонентах:
   - В типах указаны статусы `'pending' | 'accepted' | 'completed' | 'rejected'`, но в компонентах используются `'new' | 'in_progress' | 'completed' | 'skipped'`
   - В типах используются числовые ID (`id: number`), но в компонентах - строковые (`id: string`)
   - В типах есть поля `type`, `duration_minutes`, `is_quick`, которые не используются в текущих компонентах

2. Формат данных:
   - Во фронтенде используются поля `createdDate` и `completedDate`, но в типах они представлены как `created_at` и `completed_at`
   - В компонентах не используется поле `user_rating` и `user_feedback`, присутствующие в типах

3. Рекомендации по согласованию:
   - Необходимо привести в соответствие статусы рекомендаций между бэкендом и фронтендом
   - Согласовать формат ID (рекомендуется использовать строковые ID в UUID формате)
   - Привести к единому стилю именования полей (рекомендуется использовать snake_case для API и camelCase для фронтенда)
   - Дополнить API поддержкой полей обратной связи (`user_rating` и `user_feedback`), даже если они не используются в текущей версии интерфейса

4. Обработка на фронтенде:
   - При получении данных с бэкенда необходимо конвертировать поля из snake_case в camelCase
   - При отправке данных на бэкенд необходимо конвертировать поля из camelCase в snake_case 